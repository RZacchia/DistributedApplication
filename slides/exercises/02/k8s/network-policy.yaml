# ================================
# Catalog DB — allow only Catalog Service
# ================================
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: catalog-db-allow-catalog-service
  namespace: bookrent
spec:
  podSelector:
    matchLabels:
      app: catalog-db
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: catalog-service
      ports:
        - protocol: TCP
          port: 1433
---
# ================================
# Identity DB — allow only Identity Service
# ================================
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: identity-db-allow-identity-service
  namespace: bookrent
spec:
  podSelector:
    matchLabels:
      app: identity-db
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: identity-service
      ports:
        - protocol: TCP
          port: 1433
---
# ================================
# Renting DB — allow only Renting Service
# ================================
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: renting-db-allow-renting-service
  namespace: bookrent
spec:
  podSelector:
    matchLabels:
      app: renting-db
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: renting-service
      ports:
        - protocol: TCP
          port: 1433
---
# ================================
# User DB — allow only User Service
# ================================
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: user-db-allow-user-service
  namespace: bookrent
spec:
  podSelector:
    matchLabels:
      app: user-db
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: user-service
      ports:
        - protocol: TCP
          port: 1433
